# Calculating CWSS Scores

In this brief primer on calculating CWSS scores, I'll explain the mechanics of the calculation, then walk through an example by simulating some data and calculating CWSS scores for it. 

## a brief overview of notation

- $A$ and $B$ are each statements which could be true or false. We don't know either way.  
- $P(A)$ is the probability of $A$ being true, and $P(B)$ is the probability of $B$ being true.
- $P( \neg A)$ is the probability of $A$ being false. It is always equal to $1-P(A)$. This is also called the 'inverse probability' of $A$. 
- $P(A \cup B)$ is the probability of either $A$ or $B$ being true.
- $P(A \cap B)$ is the probability of both $A$ and $B$ being true.

## supporting calculations

If $A$ and $B$ are independent, which is to say that knowing whether $A$ is true or false doesn't tell us anything about whether $B$ is true or false, then the probability of both $A$ and $B$ being true $P(A \cap B)$ is the simple product of the probabilities $P(A) \cdot P(B)$.
The probability of $A$ or $B$ being true is typically given as $P(A \cup B) = P(A) + P(B) - P(A \cap B)$, where you add up the probabilities of $A$ and $B$, and then subtract the probability of both being true to avoid double counting it.
However, since we need to perform this calculation for more than two statements, and this formula doesn't generalize especially naturally to more than two statements, we'll do a bit of double negation to get the equivalent but more general formula $P(A \cup B) = P(\neg (\neg A \cap \neg B)) = 1 - P(\neg A \cap \neg B) = 1 - (1 - P(A)) * (1 - P(B))$. This is a bit less intuitive as a formula, but it makes sense if you think about it as 'the probability of either $A$ or $B$ bieng true is the same as the probability of neither $A$ nor $B$ being false'. 
If we had a third statement $C$, we could add it to the formula as $P(A \cup B \cup C) = 1 - (1 - P(A)) * (1 - P(B)) * (1 - P(C))$, and revise our natural language statement to be 'the probability that any of $A$, $B$, or $C$ is true is the same as the probability that none of $A$, $B$, or $C$ is false'.

## cwss in the abstract

To apply our supporting calculations to the CWSS score, we just need to replace the placeholder statements $A$, $B$, $C$, and so on with the actual statements we're interested in, like 'learner is a woman or beyond the binary' or 'learner is Indigenous'. 
The current inputs to the CWSS score are estimates of the percentage of the participants for which each statement is true. We can use these percentages as probabilities directly, since they're our best guess of the probability of each statement being true. 
For example (and for our purposes), "10% of learners are Indigenous" is the same as "the probability that a learner is Indigenous is 0.1" or $P(Indigenous) = 0.1$.
Equivalently, "80% of learners are women or beyond the binary" is the same as $P(Woman\ or\ beyond) = 0.8$.
If we were only striving to serve those two communities, we would calculate the CWSS score as $CWSS = P(Indigenous \cup Woman\ or\ beyond) = 1 - (1 - P(Indigenous)) * (1 - P(Woman\ or\ beyond)) = 1 - (1 - 0.1) * (1 - 0.8) = 0.82$.
In reality, the CWSS score generated by this process is just an estimate of the true proportion of learners who belong to one or more of the target communities. Even if our assumption of independence holds, there will remain some error. 

## an example

:::{.callout-note}
Throughout this example, I'm going to work in R because that's what I'm familiar with. If you're not comfortable with it, that's all good, the important point is the math, not the code. 
:::

The R packages in the 'tidyverse' have grown to become the standard toolkit for data analysis in R. 
The `dplyr` package provides a critical set of data manipulation functions that make it easy to work with data in a way that's easy to read and understand.

```{r packages}
#| caption: load the packages we'll need
library(dplyr)
library(ggplot2)
library(tidyr)
library(purrr)
library(ggdist)
```

Some fake data about fake people. You won't need to do this step, since you already have real data. This is just to illustrate the process and its accuracy.

```{r data}
#| caption: create some fake data

# sim_learners produces a tibble (a data frame) with n rows, each representing a learner.
# Each column is a community we strive to serve
# Each cell is TRUE if the learner belongs to that community, or FALSE if not
# It also includes a column cwss_actual, which is true if the learner belongs to any of the communities
sim_learners <- function(n) {
    res <-
        tibble::tibble(
            women_and_beyond = sample(c(TRUE, FALSE), n, replace = TRUE, prob = c(0.5, 0.5)),
            low_income = sample(c(TRUE, FALSE), n, replace = TRUE, prob = c(0.3, 0.7)),
            newcomer = sample(c(TRUE, FALSE), n, replace = TRUE, prob = c(0.1, 0.9)),
            physical_disability = sample(c(TRUE, FALSE), n, replace = TRUE, prob = c(0.05, 0.95))
        ) |>
        mutate(
            cwss_actual = women_and_beyond | low_income | newcomer | physical_disability
        )

    res
}
# always set the random seed when you doing simulations
set.seed(1234)

learners <- sim_learners(5000)

knitr::kable(head(learners))
```


Now that we have the data, we can calculate the membership probabilities for each community, then calculate the CWSS score and compare it to the CWSS actual value. 

```{r calculate}
calculate_cwss <- function(d) {
    d |>
        summarize(across(everything(), mean)) |>
        mutate(
            cwss_score = 1 - (
                (1 - women_and_beyond) *
                    (1 - low_income) *
                    (1 - newcomer) *
                    (1 - physical_disability)
            ),
            cwss_error = cwss_score - cwss_actual
        )
}

cwss_summary <- calculate_cwss(learners)

knitr::kable(cwss_summary)
```

We can see that, with 5000 learners, the CWSS score is, in this case, accurate to a single percentage point. 
While this level of accuracy depends on the structural truth of the independence assumption (which we enforced in our simulation), 
it should indicate that this approach yields a more accurate and interpretable result than the current method. 
